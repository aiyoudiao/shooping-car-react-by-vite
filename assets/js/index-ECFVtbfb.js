import{c as A,a as K,b as U,p as J,F as Q,R as W,P as Z,d as V,e as Y,f as _,u as ee,g as se,h as te,i as g,B as c,A as E,j as e,k as m,E as M,L as k,r as R,C as v,s as z,T as re,l as ae,m as S,n as p,o as le,S as ne,q as h,t as H,v as C,w as q,x as ce,I as $,y as ie,z as oe,D as P,G as O,H as j,J as de,K as me,M as ue,N as xe,O as pe,Q as he,U as je}from"./vendor-d5OW7B28.js";(function(){const s=document.createElement("link").relList;if(!(s&&s.supports&&s.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0})}function a(t){if(t.ep)return;t.ep=!0;const r=function(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}(t);fetch(t.href,r)}})();const D=A({name:"cart",initialState:{show:!1,subtotal:0,products:{}},reducers:{showCart(s,a){s.show=a.payload},addProduct(s,a){const{product:t,size:r,amount:l=1}=a.payload,n=s.products[t.sku]?.[r];n?n.amount+=l:s.products[t.sku]={...s.products[t.sku],[r]:{product:t,size:r,amount:l}}},changeProductAmount(s,a){const{sku:t,size:r,amount:l}=a.payload;s.products[t]?.[r]&&(s.products[t][r].amount=l)},increase(s,a){const{sku:t,size:r,amount:l=1}=a.payload;s.products[t]?.[r]&&(s.products[t][r].amount+=l)},decrease(s,a){const{sku:t,size:r,amount:l=1}=a.payload;if(s.products[t]?.[r]){const n=Math.max(0,s.products[t][r].amount-l);n>0?s.products[t][r].amount=n:delete s.products[t][r]}},removeProduct(s,a){const{sku:t,size:r}=a.payload;s.products[t]?.[r]&&delete s.products[t][r]},clearCart(s){s.products={}}}}),{showCart:f,addProduct:fe,changeProductAmount:ge,increase:He,decrease:qe,removeProduct:ve,clearCart:be}=D.actions,ye=D.reducer,G=A({name:"product",initialState:{sizes:[],sort:[{property:"price",order:"desc"}]},reducers:{changeSizes(s,a){s.sizes=a.payload},changeSort(s,a){s.sort=a.payload}}}),{changeSizes:F,changeSort:Ne}=G.actions,b=U({reducer:se({key:"root",storage:te},K({cart:ye,product:G.reducer})),middleware:s=>s({serializableCheck:{ignoredActions:[Q,W,Z,V,Y,_]}})}),we=J(b),i=s=>b.dispatch(s),L=ee,d=s=>{if(typeof s!="string")return L(s);const a=L(t=>t);try{if(s.indexOf(".")>-1){const t=s.split(".");let r=a;for(let l=0;l<t.length;l++)r=r[t[l]];return r}}catch{return null}return a[s]},X=g(s=>s?.cart?.products,(s={})=>Object.values(s).reduce((a,t)=>a+Object.values(t).reduce((r,l)=>r+l.amount,0),0)),ke=g(s=>s?.cart?.products,(s={})=>Object.values(s)?.reduce((a,t)=>a+Object.values(t).reduce((r,l)=>r+l.product.price*l.amount,0),0)),ze=g(s=>s?.cart?.products,(s={})=>Math.max(...Object.values(s).flatMap(a=>Object.values(a).map(t=>t.product.installments??0))));c.DP=20,c.RM=1;class T{static format(a,t=2){return a.toFixed(t)}static add(a,t,r=2){const l=new c(a).plus(new c(t));return this.format(l,r)}static subtract(a,t,r=2){const l=new c(a).minus(new c(t));return this.format(l,r)}static multiply(a,t,r=2){const l=new c(a).times(new c(t));return this.format(l,r)}static divide(a,t,r=2){const l=new c(a).div(new c(t));return this.format(l,r)}static pow(a,t,r=2){const l=new c(a).pow(t);return this.format(l,r)}static compare(a,t){return new c(a).cmp(new c(t))}static sqrt(a,t=2){const r=new c(a).sqrt();return this.format(r,t)}}const Se=s=>{const{amount:a,product:t,size:r,onDelete:l}=s;return e.jsxs("div",{className:"flex items-start py-4",children:[e.jsx("img",{className:"w-18 h-28 object-cover rounded-md",src:`static/products/${t.sku}-1-product.webp`,alt:t.title}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h4",{className:"text-lg text-gray-800 font-bold mb-1 line-clamp-2",title:"product.title",children:t.title}),e.jsxs("div",{className:"text-sm text-gray-600  mb-1",children:[r," 码 ",t.style&&e.jsxs(e.Fragment,{children:[" | ",t.style]})]}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-xl mr-1",children:t.currencyFormat}),e.jsx("span",{className:"text-lg font-bold",children:t.price.toFixed(2)})]}),e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"数量："}),e.jsx(re,{className:"w-16",value:a,size:"small",min:1,onChange:n=>{n!==null&&i(ge({sku:t.sku.toString(),size:r,amount:n}))}}),e.jsx(m,{type:"text",className:"py-6 mt-auto text-2xl ml-8",danger:!0,onClick:l,children:e.jsx(ae,{})})]})]})]})},Ce=s=>{const a=Object.entries(s.value);return a.length===0?e.jsx("div",{className:"py-8",children:e.jsx(M,{description:"请添加商品到购物车"})}):e.jsx(k,{className:"bg-white ",children:a.map(([t,r])=>e.jsx(R.Fragment,{children:Object.entries(r).map(([l,n])=>e.jsx(k.Item,{children:e.jsx(Se,{product:n.product,amount:n.amount,size:n.size,onDelete:()=>{i(ve({sku:t,size:l}))}})},l))},t))})},$e=s=>{if(!s.value)return null;let a;return s.installments&&(a=T.divide(s.value,s.installments)),e.jsxs("div",{className:"flex items-center mb-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 text-lg font-semibold",children:"小计："}),e.jsxs("div",{className:"flex-1 text-right text-lg font-bold ",children:["$",s.value.toFixed(2)]}),a&&e.jsxs("div",{className:"text-right ml-2 text-sm w-full",children:["最多可分 ",e.jsx("span",{className:"font-bold text-orange-500",children:s.installments})," 期"," ",e.jsxs("span",{className:"font-bold text-green-500",children:["$",a]})," /月"]})]})},Pe=s=>{const a=["#6253E1","#04BEFE"];return e.jsx(v,{theme:{components:{Button:{colorPrimary:`linear-gradient(135deg, ${a.join(", ")})`,colorPrimaryHover:`linear-gradient(135deg, ${(t=a,t.map(r=>new S(r).lighten(5).toString())).join(", ")})`,colorPrimaryActive:`linear-gradient(135deg, ${(r=>r.map(l=>new S(l).darken(5).toString()))(a).join(", ")})`,lineWidth:0}}},children:e.jsx(m,{type:"primary",size:"large",...s})});var t},Oe=()=>{const s=d("cart.products"),a=d(X),t=d(ke),r=d(ze),{modal:l}=E.useApp();return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 px-2 min-h-0  overflow-y-auto scrollbar-none",children:e.jsx(Ce,{value:s})}),e.jsxs("div",{className:"p-4 border-t border-solid border-gray-300",children:[e.jsx($e,{value:t,installments:r}),t?e.jsx(Pe,{block:!0,onClick:()=>{Object.keys(s).length?l.confirm({title:"结算",content:`当前共 ${a} 件商品，金额 $${t}，确定支付？`,onOk(){i(be()),z.success({message:"结算完成",description:`共支付 $${t}`,placement:"top",closeIcon:!1}),i(f(!1))}}):z.warning({message:"系统提示",description:"购物车是空的，请添加你心仪的商品到购物车吧",placement:"top",duration:1,closeIcon:!1})},children:"结算"}):e.jsx(m,{type:"primary",className:"mt-16",block:!0,size:"large",disabled:!0,children:"无法结算"})]})]})},B=["XS","S","M","ML","L","XL","XXL"].map(s=>({label:s,value:s})),Fe=()=>{const{sort:s,sizes:a}=d("product"),[t]=s;return e.jsxs(p,{children:[e.jsxs(p.Item,{className:"mb-2",label:e.jsx("span",{className:"font-bold text-lg",children:"尺寸"}),children:[e.jsx(le.Group,{className:"hidden sm:block text-lg",value:a,options:B,onChange:r=>{i(F(r))}}),e.jsx(ne,{className:"sm:hidden text-md",options:B,mode:"multiple",value:a,onChange:r=>{i(F(r))}})]}),e.jsx(p.Item,{className:"mb-2",label:e.jsx("span",{className:"font-bold text-lg",children:"价格"}),children:e.jsxs(h.Group,{value:t.order,onChange:r=>{i(Ne([{order:r.target.value,property:"price"}]))},children:[e.jsx(h.Button,{value:"asc",className:"text-md",children:"按价格升序"}),e.jsx(h.Button,{value:"desc",className:"text-md",children:"按价格降序"})]})})]})},I=({sku:s})=>{const a=`./static/products/${s}-1-product.webp`,t=`./static/products/${s}-2-product.webp`;return e.jsx("div",{className:"!w-full !h-full max-h-60 rounded-t-lg overflow-hidden",children:e.jsx($.PreviewGroup,{items:[a,t],children:e.jsx($,{src:a})})})},Le=()=>e.jsx(H,{"data-test-id":"loading-card",cover:e.jsx(C.Image,{active:!0,className:"!w-full min-h-72 rounded-t-lg"}),children:e.jsx(C,{active:!0})}),Be=s=>e.jsx(v,{theme:{components:{Segmented:{itemActiveBg:"rgb(30 64 175)",itemColor:"#1890ff",itemHoverBg:"rgb(37 99 235)",itemHoverColor:"#1890ff",itemSelectedBg:"rgb(29 78 216)",itemSelectedColor:"#fff",trackBg:"#000",trackPadding:"0"}}},children:e.jsx(ie,{...s})}),Ie=s=>{const[a,t]=R.useState(s.data.availableSizes[0]),{data:r}=s,[l,n]=String(r.price.toFixed(2)).split(".");return e.jsx(H,{className:"relative transition-all transform hover:scale-105 cursor-pointer",cover:r.isFreeShipping?e.jsx(q.Ribbon,{placement:"end",text:"包邮","data-test-id":"free-shipping",children:e.jsx(I,{sku:r.sku})}):e.jsx(I,{sku:r.sku}),children:e.jsxs("div",{className:"flex flex-col items-center",children:[r.availableSizes.length>0&&e.jsx("div",{className:"flex justify-end w-full -mr-12",children:e.jsx(Be,{className:"-mt-6 mb-3",block:!0,size:"small",options:r.availableSizes.map(o=>({label:e.jsxs("div",{className:"flex items-center justify-center w-5 h-7 rounded-full m-0.5 text-white text-xs",children:[o," 码"]}),value:o})),value:a,onChange:o=>{t(o)}})}),e.jsx("p",{className:"min-h-14 text-lg font-semibold line-clamp-2",title:r.title,children:r.title}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"text-2xl",children:r.currencyFormat}),e.jsx("span",{className:"text-2xl font-bold",children:l}),e.jsxs("span",{className:"text-xl",children:[".",n]})]}),r.installments>0?e.jsxs("p",{"data-test-id":"installments",className:"text-gray-500 text-sm",children:["或分 ",e.jsx("span",{className:"font-bold text-orange-500",children:r.installments})," 期，每期",e.jsxs("span",{className:"font-bold text-green-500",children:[" $",T.divide(r.price,r.installments)]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"暂不支持分期"}),e.jsx(m,{"data-test-id":"add-product",className:"mt-2",type:"primary",block:!0,onClick:()=>{i(fe({product:r,size:a})),ce.success({content:`客官，您已成功将 ${r.title} - [${a}] 添加到购物车中。`,duration:1})},children:"添加到购物车"})]})})},Ae=()=>{const s=d("product.sizes"),a=d("product.sort"),{data:t,error:r,isLoading:l,mutate:n}=oe(["products",s,a],async()=>{try{return await(async(y,N)=>{try{const u=new URLSearchParams;y?.sizes&&u.append("sizes",y.sizes.join(",")),N?.sort&&N.sort.forEach(w=>{u.append("sort",`${w.property},${w.order}`)});const x=await fetch(`https://apifoxmock.com/m1/4719799-4372142-default/api/v1/products?${u.toString()}`);if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);return(await x.json()).data.products||[]}catch{return[]}})({sizes:s},{sort:a})}catch(o){throw o}},{dedupingInterval:5e3,revalidateOnFocus:!1,shouldRetryOnError:!1});return{data:t,error:r,refetch:n,isLoading:l}},Ee=()=>{const{data:s,isLoading:a,error:t,refetch:r}=Ae(),l=s?.length??0;return a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 font-bold text-lg",children:"商品正在加载中..."}),e.jsx(P,{gutter:[16,16],children:Array.from({length:8}).map((n,o)=>e.jsx(O,{xs:12,sm:8,md:6,children:e.jsx(Le,{})},o))})]}):t?e.jsxs("div",{className:"flex flex-col items-center py-6",children:[e.jsx(M,{description:"获取商品列表失败，请刷新重试"}),e.jsx(m,{className:"mt-4",type:"primary",onClick:()=>{r()},children:"重试"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-2 font-bold text-lg",children:["共找到 ",l," 个商品"]}),e.jsx(P,{gutter:[16,16],children:s?.map(n=>e.jsx(O,{xs:12,sm:8,md:6,children:e.jsx(Ie,{data:n})},n.id))})]})};function Me(){const s=d("cart.show"),a=d(X)||0;return e.jsxs(j,{className:"min-h-full",children:[e.jsx(j.Header,{className:"z-10 sticky bg-blue-600 top-0 w-full px-4 lg:px-8",children:e.jsxs("div",{className:"flex  items-center h-full",children:[e.jsx("div",{className:"text-2xl text-white",children:"购物车"}),e.jsx("div",{className:"flex justify-end items-center h-full flex-auto"}),e.jsx("button",{className:"flex justify-center items-center text-white p-2 rounded-lg text-2xl bg-transparent border-none hover:bg-white/10 active:bg-white/20",onClick:()=>{i(f(!0))},children:e.jsx(q,{count:a,showZero:!0,color:"#faad14",offset:[0,0],children:e.jsx(de,{className:"text-3xl text-white align-middle"})})})]})}),e.jsx(j.Content,{className:"overflow-y-auto scrollbar-none",children:e.jsxs("div",{className:"flex flex-col max-w-5xl mx-auto p-4 overflow-y-auto scrollbar-none",children:[e.jsx(Fe,{}),e.jsx(Ee,{})]})}),e.jsx(me,{open:s,onClose:()=>i(f(!1)),title:"购物车结算",placement:"right",style:{padding:0},children:e.jsx(Oe,{})})]})}ue.createRoot(document.getElementById("root")).render(e.jsx(xe.StrictMode,{children:e.jsx(pe,{store:b,children:e.jsx(he,{persistor:we,children:e.jsx(v,{locale:je,children:e.jsx(E,{children:e.jsx(Me,{})})})})})}));
